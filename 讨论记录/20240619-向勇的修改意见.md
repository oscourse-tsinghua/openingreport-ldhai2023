## 20240619-向勇的修改意见

#### 摘要

1. 需要先肯定一下微内核的好处。
	1. acc：安全性和稳定性等。
2. 微内核的开销大：目前的概括有些乱。开销大致可分成切换开销（多次特权级切换、阻塞等待开销）和缓存失效开销。你的论文工作只涉及减少切换开销，减少缓存失效的效果是间接的。
	1. 缓存失效有误导，不必在此强调。
	2. 不强调Rust，而强调异步。
3. 论文的贡献点：利用用户态中断和Rust异步编程优化微内核的notification、IPC和系统调用，以减少切换开销。

#### 引言

1. 引言的写作目标是，先描述论文工作所处领域在干什么，然后说面临的挑战，你想做什么，需要解决哪些问题（需要明确困难所在，为描述你的思路做铺垫），最后说预期收益和文章的内容安排。第三段和第五段可以简单说，在这里不需要直接说结论。
	1. 微内核固有的好处还是需要介绍。
	2. 直接说实验结论需要斟酌。

#### 背景

1. 这一部分要用及时和权威的文献来支持你的描述。如“同步IPC强制用户对原本简单的系统进行多线程设计”。
	1. 先添加引用。
	2. 确认这个说法。
2. 这一部分的组织结构是合理的，在简要描述微内核的发展路径后，先描述面临的挑战，再分类描述已有解决方案和不足，最后用表格总结已有工作，并引出自己的思路。但内容还有待仔细的梳理和归类描述。
	1. 遣词方面需要反复斟酌（信号、中断）。
3. 行文需要力求准确。“用户态中断通过硬件转发的方式，在无需陷入内核的情况下，将信号发送给其他用户态程序”这一句中的“信号”就被审稿人认为“理解不到位”。
4. 我仍然认为Rust异步机制需要加上介绍。原因是，已有的select机制就是为了减少阻塞等待的机制，Rust异步是从语言的角度来处理这个问题，做法更可读和易用。

#### 设计

1. 我感觉文章中少了从seL4到reL4的这一段描述。建议补上。可以放在“背景”中，正好说明一下，我们为什么要把seL4用Rust重写。
		1. 缺少Rust的介绍。
2. 这一部分需要有一个系统组成结构图来把各组成部分整合成一个整体，以帮助读者理解论文的设计。
	1. 用户态中断（多了硬件组件）
	2. 内核、硬件分工（控制和通信分离）
	3. 用户态的兼容和适配

#### 3.1 U-notification

1. 3.1节的图：目前的版本有了明显的改进。我感觉还有一部分数据是放在用户态的，这个图中并没有体现出来。这个图需要表达清楚以下内容：
   - reL4与seL4的通知机制的不同；
   - 通知机制放在内核中的数据结构；
   - 通知机制放在在控制器中的数据结构；
   - 通知机制放在用户库中的数据结构；
	   - acc
1. 兼容性问题：用户库提供的API是兼容的；不支持广播；
2. 没有广播支持，会有什么麻烦吗？或者给一个用
3. 建议明确描述reL4与seL4的通知机制处理流程变化（分注册、收发描述），并分析其性能特征变化（注册通过内核，第一次通知通过硬件或内核，第二次收发通过硬件）。我的描述成立吗？
	1. 注册机制的兼容性隐藏在第一次通讯中。


#### 3.2 异步IPC

1. “将同步IPC从微内核中移除”这个陈述成立吗？如果成立，如何把收方注册的“通知句柄”告诉发方？
	1. 需要思考可行性。
2. 我建议把异步IPC与异步系统调用分成两个插图来表达。异步系统调用会涉及特权级切换，异步IPC应该是没有的。
3. 异步运行时中需要画出协程的调度器，并说明在内核中原来的内核调度器与协程调度器的关系。这一条修改涉及“3.3 异步系统调用”的内容。
	1. acc

#### 3.2.1 共享内存

1. 环形缓冲区需要单独描述吗？如果需要，现在的版本没有说清楚；否则，可以通过文献引用一笔带过。
2. 建议补充共享内存相关API的兼容性描述。

#### 3.2.2 异步运行时

1. 这一部分的组织有些跳跃，会让读者费解。也许换个标题，会好理解一些。我没有想好用什么标题更合适。异步运行时的作用是，利用Rust异步机制来提高IPC的并发性，减少阻塞等待和进一步减少切换次数。需要讨论异步IPC与微内核IPC的API兼容性。
	1. 兼容性讨论。
	2. 根据减少切换次数、减少等待、提升并发性三个点进行讨论。

#### 3.3 异步系统调用

1. 我没有太明白内核调度器与异步运行时中的协程调度器的关系，特别是与优先级相关的部分与多核放到一起时的状态。我的理解是，在seL4中有进入内核的大锁，并使用自旋锁抢大锁；在reL4中会用IPI的。是这样吗？
	1. 尽可能描述清楚。

#### 4. 实现

1. “ntfn_cap”对应的中断控制器资源是由root server管理吗？
	2.内核管理，root server或许也可以管理，但需要仔细设计。
1. 系统调用UintrRegisterAsyncSyscall是异步的吗？
	1. 同步
2. 关于优先级机制，我没有理解的是，你的实现做到什么程度？对于未来工作，建议不放在这里进行说明。
	1. 只提任务优先级，不提IPC优先级。
3. 关于“异步系统调用的中断抢占”的讨论与前后都不直接相关，不明白为什么放在这里？
	1. 放到其他地方去。

#### 5. 性能评估

1. 建议通过源代码仓库、测试数据等链接来准确描述你的测试实验环境信息。我的理解是，reL4的代码分sync、sync-fp和async三个版本，测试环境分up和smp，测试场景分多种并发连接数，测试指标分执行时间和吞吐率。是这样吗？
	1. 切换次数的指标
	2. 测试维度不够

#### 5.1 同步IPC vs. 异步IPC

1. 目前的测试实验感觉有些笼统，建议对照摘要中描述的特征进行细致的实验分析，以验证描述的特征是确实存在的。

#### 5.2 TCP Server

1. 综合实验中有可能加上seL4的对比吗？
	1. 可以，会进行补充

#### 6. 总结

1. 这一部分，我只是浏览了一下。没有仔细看。
2. 对整个论文的评价是很不错，内容是充实的；论文组织和文字还有不小的改进空间。

#### 输入错误

1. 对比了了