# 时间表

| 章节       | 计划完成的时间节点 |
| -------- | --------- |
| 摘要       | 3月12日     |
| 绪论       | 3月19日     |
| seL4介绍   | 3月23日     |
| seL4系统设计 | 3月27日     |
| seL4系统实现 | 4月1日      |
| 兼容性讨论    | 4月3日      |
| 性能评估     | 4月8日      |
| 总结       | 4月9日      |
# 摘要
**计划完成时间：3月12日**
1. 肯定微内核相比于宏内核的优势（安全性、稳定性、模块化）。
2. 指出微内核的设计不足（IPC机制冗余、IPC和系统调用都需要特权级切换导致性能瓶颈）。
3. 引出我们的工作：
	1. 移除同步IPC
	2. 通过硬件提升通知机制的性能
	3. 基于通知机制实现异步IPC和异步系统调用。
4. 实验评估和结论。

关键词：微内核；异步；用户态中断；软硬结合。

# 1. 绪论
## 1.1 研究背景及意义
**计划完成时间：3月15日**
- 微内核的设计理念与优势
	- 将大部分系统功能转移到用户态，应用程序请求一些公共服务通过IPC的形式来进行，而现代微内核大多以同步IPC作为进程间的通信方式，同时用异步的通知机制作为辅助。这些设计在安全性、模块化等方面相比宏内核具有显著优势。
- 现代微内核的设计缺陷：
	- 冗余支持异步IPC（违反最小化原则）
	- 同步IPC与异步通知需要内核转发，上下文切换成为性能瓶颈。

## 1.2 国内外研究现状
- 介绍微内核的发展
	- 微内核的IPC发展思路，从而导出现代微内核中IPC的两个问题：
		- 违反内核最小化原则。
		- 同步IPC对多核利用效率不高。
		- 性能瓶颈：特权级切换。
- 介绍特权级切换产生的开销：
	- 上下文切换。
	- 页表切换。
	- 缓存失效，快表污染。
- 内核路径优化。
	- 主要介绍了seL4等现代化微内核作出的软件相关优化
- 上下文切换优化。
	- 软件优化：
		- 系统架构优化。
		- 软件处理方式优化。
		- 编译器优化。
	- 硬件优化：
		- 借助特殊指令集（虚拟化）
		- 借助特殊硬件
- 本文用到的技术：
	- 软件方面：
		- 异步编程介绍
		- 用户态中断介绍
		- 硬件调度队列（TAIC介绍）

## 1.3 主要研究内容介绍和论文结构介绍：
- 在内核态移除同步IPC，精简微内核机制
- 基于用户态中断，在内核态设计U-notification，减少上下文切换，提升性能。
- 基于异步编程机制和硬件调度队列，在用户态设计异步运行时，并实现无需陷入内核的异步系统调用和异步 IPC 框架，提升用户态易用性。
- 基于硬件调度队列，减少调度开销，提升低并发下的IPC性能。

# 2. seL4介绍

## 2.1 seL4的发展和主要特征
- 发展历史
	- 继承自L4。
	- 对L4的扬弃
- 主要特征：
	- 形式化验证
## 2.2 seL4的基本组成
- 内核对象与权限控制
	- capability机制
- 内存管理
	- vspace
	- untyped
- 任务调度
	- 任务定义（进程、线程）
	- 优先级调度
	- 任务抢占
- IPC机制和相关优化
	- 同步IPC
	- 异步notification
	- fast-path
- 中断管理
	- 中断代理，中断屏蔽
- SMP支持
	- 内核锁
	- 核间通信

# 3. ReL4系统设计
- 与seL4的关系
- 需要一张架构图来描述ReL4的结构以及相比于seL4的特点。
- 目标：
	- 精简微内核、移除同步IPC，由异步通知机制实现同步IPC
	- 避免特权级切换和中断，提升性能
	- 简化异步编程模型，提升易用性。
## 3.1 通知机制
- 介绍U-notificaiton的设计
	- 基于用户态中断的 与 基于TAIC的。
- 介绍自适应混合轮询。
## 3.2 异步运行时
- 共享缓冲区
- 协程与调度器
	- 软件实现的调度器与TAIC调度器。
- API兼容层
# 4. 系统实现
## 4.1 新增系统调用
- 描述相比于seL4，我们在内核态新增的用户态中断管理相关的系统调用
## 4.2 异步IPC实现
- 需要一个流程图或伪代码描述异步IPC的工作流程。
- 相关的优化手段（零拷贝、无锁队列、自适应混合轮询）
## 4.3 异步系统调用实现
- 相比于异步IPC的区别
- 执行优先级介绍
# 5. 兼容性讨论
- notification与U-notification
- 同步IPC与异步IPC。
- 异步系统调用的兼容性
# 6. 系统评估
- 实验设置。
- 功能测试。
	- 成功通过seL4test所有测例。
	- 分析seL4和reL4在seL4test的性能表现。
- U-notification vs. 原始notification
	- 原始notification与U-notification的阶段耗时分析
- 轮询 vs 中断 vs 自适应混合轮询
- 同步IPC vs. 异步IPC。
	- 阶段耗时分析。
- TCP服务器测试
- 内存分配服务器
# 7. 总结
- 总结研究内容，强调研究结果：本文将同步IPC从内核中移除，并利用用户态中断机制与TAIC在微内核中设计了一套无需陷入内核的异步IPC框架，并基于异步IPC框架对系统调用也进行了异步化改造，从而设计出一个完全异步的高性能微内核，经测试，异步IPC将IPC的性能最高提升了387.8%，在IPC频繁的系统中（如网络服务器）将系统性能最高提升1x。
- 论述研究意义，提升论文定位：异步IPC和异步系统调用主要是为了提升高频度、上下文无关的IPC和系统调用请求的整体处理性能，因此在并发度高的系统中拥有卓越的表现，此外，在并发度低的情况下，我们仍然通过用户态中断和硬件调度队列这种开销相对较小的方式来取代特权级切换，从而在一定程度上弥补了低并发度情况下引入异步运行时带来的额外开销。